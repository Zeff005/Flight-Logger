<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INVA Receipt Generator</title>
<style>
  * { box-sizing: border-box; }
  
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: #1e293b;
  }
  
  .container { 
    max-width: 1200px; 
    margin: 0 auto; 
    background: #ffffff; 
    border-radius: 16px; 
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    overflow: hidden;
  }
  
  .header {
    background: linear-gradient(135deg, #0ea5a4 0%, #0d8f8e 100%);
    color: white;
    padding: 30px;
    text-align: center;
  }
  
  .header h1 { 
    margin: 0 0 8px; 
    font-size: 32px;
    font-weight: 600;
  }
  
  .header .subtitle { 
    opacity: 0.95;
    font-size: 15px;
  }
  
  .content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
  }
  
  .form-section {
    padding: 30px;
    background: #f8fafc;
    border-right: 1px solid #e2e8f0;
  }
  
  .receipt-section {
    padding: 30px;
    background: #ffffff;
  }
  
  .section-title {
    font-size: 18px;
    font-weight: 600;
    margin: 0 0 20px;
    color: #0f172a;
    padding-bottom: 10px;
    border-bottom: 2px solid #0ea5a4;
  }
  
  .form-group { 
    margin-bottom: 18px; 
  }
  
  label { 
    display: block; 
    font-size: 14px; 
    margin-bottom: 6px; 
    font-weight: 500;
    color: #334155;
  }
  
  input, select, textarea { 
    width: 100%; 
    padding: 12px; 
    border-radius: 8px; 
    border: 1px solid #cbd5e1; 
    font-size: 14px;
    transition: all 0.3s ease;
    background: white;
  }
  
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: #0ea5a4;
    box-shadow: 0 0 0 3px rgba(14, 165, 164, 0.1);
  }
  
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  
  .controls { 
    display: flex; 
    gap: 12px; 
    margin-top: 24px; 
  }
  
  button { 
    flex: 1;
    padding: 14px 20px; 
    border-radius: 8px; 
    border: none; 
    background: #0ea5a4; 
    color: #fff; 
    cursor: pointer; 
    font-size: 15px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(14, 165, 164, 0.3);
  }
  
  button:hover { 
    background: #0d8f8e;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(14, 165, 164, 0.4);
  }
  
  button:active {
    transform: translateY(0);
  }
  
  button.secondary {
    background: #64748b;
    box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);
  }
  
  button.secondary:hover {
    background: #475569;
  }
  
  .receipt { 
    background: #ffffff;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  }
  
  .receipt-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: flex-start;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid #0ea5a4;
  }
  
  .receipt-header h2 {
    margin: 0 0 8px;
    font-size: 24px;
    color: #0ea5a4;
  }
  
  .receipt-meta {
    font-size: 13px;
    color: #64748b;
    line-height: 1.6;
  }
  
  .receipt-logo {
    text-align: right;
    font-weight: 600;
    color: #0ea5a4;
    font-size: 14px;
  }
  
  table { 
    width: 100%; 
    border-collapse: collapse; 
    margin-bottom: 16px;
  }
  
  td, th { 
    padding: 10px 12px; 
    border-bottom: 1px solid #f1f5f9; 
    text-align: left;
    font-size: 14px;
  }
  
  td:first-child {
    color: #64748b;
    font-weight: 500;
  }
  
  td:last-child {
    color: #0f172a;
    font-weight: 600;
  }
  
  .totals-table td {
    padding: 12px;
    font-size: 15px;
  }
  
  .totals-table tr:last-child td {
    border-top: 2px solid #0ea5a4;
    border-bottom: 2px solid #0ea5a4;
    padding: 14px 12px;
    font-size: 16px;
    font-weight: 700;
    color: #0ea5a4;
  }
  
  .right { 
    text-align: right; 
  }
  
  .notes { 
    margin-top: 20px; 
    padding: 12px;
    background: #f8fafc;
    border-radius: 8px;
    font-size: 12px;
    color: #64748b;
    line-height: 1.5;
  }
  
  .alert {
    padding: 14px 18px;
    border-radius: 8px;
    margin-top: 16px;
    font-size: 14px;
    font-weight: 500;
    display: none;
    animation: slideIn 0.3s ease;
  }
  
  .alert.success {
    background: #d1fae5;
    color: #065f46;
    border: 1px solid #a7f3d0;
  }
  
  .alert.error {
    background: #fee2e2;
    color: #991b1b;
    border: 1px solid #fecaca;
  }
  
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .helper-text {
    font-size: 12px;
    color: #64748b;
    margin-top: 6px;
  }
  
  /* Mobile responsiveness */
  @media (max-width: 968px) {
    .content {
      grid-template-columns: 1fr;
    }
    
    .form-section {
      border-right: none;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .form-row {
      grid-template-columns: 1fr;
    }
    
    .header h1 {
      font-size: 24px;
    }
    
    body {
      padding: 10px;
    }
    
    .container {
      border-radius: 8px;
    }
    
    .form-section, .receipt-section {
      padding: 20px;
    }
    
    button {
      padding: 12px 16px;
      font-size: 14px;
    }
  }
  
  @media (min-width: 969px) {
    /* Ensure desktop maintains the same look */
    .content {
      grid-template-columns: 1fr 1fr;
    }
  }
  
  @media print {
    body {
      background: #fff;
      margin: 0;
      padding: 20px;
    }
    
    .container {
      box-shadow: none;
      border-radius: 0;
      max-width: 100%;
    }
    
    .header, .form-section, .controls, button, .alert {
      display: none !important;
    }
    
    .content {
      display: block;
    }
    
    .receipt-section {
      padding: 0;
    }
    
    .receipt {
      border: none;
      box-shadow: none;
    }
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>‚úàÔ∏è INVA Receipt Generator</h1>
    <div class="subtitle">Professional Flight Earnings & Receipt Management System</div>
  </div>

  <div class="content">
    <!-- Form Section -->
    <div class="form-section">
      <h3 class="section-title">Flight Details</h3>
      
      <div class="form-group">
        <label>Pilot Name *</label>
        <input type="text" id="pilot" placeholder="Enter pilot name">
      </div>

      <div class="form-group">
        <label>Rank *</label>
        <select id="rank">
          <option value="">-- Select Rank --</option>
          <option value="Cadet / Trainee" data-rate="1333" data-maxbonus="750">Cadet / Trainee</option>
          <option value="Junior FO" data-rate="1800" data-maxbonus="1250">Junior FO</option>
          <option value="First Officer" data-rate="2600" data-maxbonus="2250">First Officer</option>
          <option value="Senior FO" data-rate="3100" data-maxbonus="2750">Senior FO</option>
          <option value="Captain" data-rate="3500" data-maxbonus="3250">Captain</option>
          <option value="Senior Captain" data-rate="3800" data-maxbonus="3750">Senior Captain</option>
          <option value="Chief Pilot" data-rate="4000" data-maxbonus="4250">Chief Pilot</option>
        </select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>INVA Callsign *</label>
          <input type="text" id="callsign" placeholder="e.g. 123" maxlength="3" pattern="\d{3}">
          <div class="helper-text">3 digits only</div>
        </div>

        <div class="form-group">
          <label>Flight Number *</label>
          <input type="text" id="flightnum" placeholder="e.g. IX998">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Departure ICAO *</label>
          <input type="text" id="depicao" placeholder="e.g. VIDP" maxlength="4">
        </div>

        <div class="form-group">
          <label>Arrival ICAO *</label>
          <input type="text" id="arricao" placeholder="e.g. VABB" maxlength="4">
        </div>
      </div>

      <div class="form-group">
        <label>Aircraft *</label>
        <select id="aircraft">
          <option value="">-- Select Aircraft --</option>
          <option value="A319" data-mult="1.00">A319 ‚Äî √ó1.00</option>
          <option value="A320" data-mult="1.00">A320 ‚Äî √ó1.00</option>
          <option value="B738" data-mult="1.00">B738 ‚Äî √ó1.00</option>
          <option value="B737 MAX" data-mult="1.05">B737 MAX ‚Äî √ó1.05</option>
          <option value="A321" data-mult="1.05">A321 ‚Äî √ó1.05</option>
          <option value="B788" data-mult="1.15">B788 ‚Äî √ó1.15</option>
          <option value="B789" data-mult="1.15">B789 ‚Äî √ó1.15</option>
          <option value="B77W" data-mult="1.25">B77W ‚Äî √ó1.25</option>
          <option value="B77L" data-mult="1.25">B77L ‚Äî √ó1.25</option>
          <option value="B744" data-mult="1.50">B744 ‚Äî √ó1.50</option>
          <option value="A350" data-mult="1.35">A350 ‚Äî √ó1.35</option>
        </select>
      </div>

      <div class="form-group">
        <label>Flight Time *</label>
        <input type="text" id="ftime" placeholder="e.g. 03:34 or 3.5667">
        <div class="helper-text">Format: hh:mm or decimal hours</div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Passengers *</label>
          <input type="number" id="passengers" placeholder="e.g. 150" min="0" step="1">
        </div>

        <div class="form-group">
          <label>Cargo Weight (kg) *</label>
          <input type="text" id="cargo" placeholder="e.g. 3000" inputmode="numeric">
        </div>
      </div>

      <div class="form-group">
        <label>Fuel Used (kg) *</label>
        <input type="number" id="fuelused" placeholder="e.g. 20000" min="0" step="1">
      </div>

      <div class="controls">
        <button type="button" id="sendBtn">üì§ Submit Flight</button>
        <button type="button" id="printBtn" class="secondary">üñ®Ô∏è Print / PDF</button>
      </div>

      <div id="alertBox" class="alert"></div>
    </div>

    <!-- Receipt Section -->
    <div class="receipt-section">
      <h3 class="section-title">Live Receipt Preview</h3>
      
      <div class="receipt" id="receipt">
        <div class="receipt-header">
          <div>
            <h2>INVA RECEIPT</h2>
            <div class="receipt-meta">
              <div>Receipt #: <strong id="rno">VA-0001</strong></div>
              <div>Date: <strong id="rdate">-</strong></div>
            </div>
          </div>
          <div class="receipt-logo">
            INVA<br>Career Mode
          </div>
        </div>

        <table>
          <tbody>
            <tr><td>Pilot</td><td id="rpilot">-</td></tr>
            <tr><td>Rank</td><td id="rrank">-</td></tr>
            <tr><td>INVA Callsign</td><td id="rcallsign">-</td></tr>
            <tr><td>Flight Number</td><td id="rflightnum">-</td></tr>
            <tr><td>Route</td><td id="rroute">-</td></tr>
            <tr><td>Aircraft</td><td id="rair">-</td></tr>
            <tr><td>Flight Time</td><td id="rftime">-</td></tr>
            <tr><td>Base Rate</td><td id="rbase">‚Çπ0.00</td></tr>
            <tr><td>Multiplier</td><td id="rmult">√ó1.00</td></tr>
          </tbody>
        </table>

        <table class="totals-table">
          <tbody>
            <tr><td>Flight Earnings</td><td class="right" id="rearn">‚Çπ0.00</td></tr>
            <tr><td>Payload Bonus</td><td class="right" id="rbonus">‚Çπ0.00</td></tr>
            <tr><td>Deductions (15% Tax)</td><td class="right" id="rded">‚Çπ0.00</td></tr>
            <tr><td>Grand Total</td><td class="right" id="grand">‚Çπ0.00</td></tr>
            <tr><td>Estimated (USD)</td><td class="right" id="rusd">$0.00</td></tr>
          </tbody>
        </table>

        <div class="notes">
          <strong>Note:</strong> This receipt is generated for INVA virtual airline use only. 
          All calculations include base rate, aircraft multiplier, payload bonus (based on load factor 
          and efficiency), and applicable deductions. Do not use for fraudulent real-world claims.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ========================================
// CONFIGURATION - REPLACE WITH YOUR VALUES
// ========================================

// Discord Webhook URL - Replace with your actual webhook
const DISCORD_WEBHOOK_URL = "https://discordapp.com/api/webhooks/1424101218283946128/GuS7iqwSLSZyRR6yYgqu2yjjn3Y4nvEq6CG0rb_yT_lZxEdQaRGjGcSZvCDOtWf2GOHN";

// Google Sheets Configuration
const GOOGLE_SHEET_CONFIG = {
  // Replace with your Google Apps Script Web App URL
  scriptUrl: "https://script.google.com/macros/s/AKfycbzqTyCIr3opchA4aw7Tf7xF8LSXTU0KX1VSJdGkl4FmSj_Bi-so3oFne0NR0oeFKCQ/exec",
  // The script will handle authentication and sheet operations
};

// ========================================
// UTILITY FUNCTIONS
// ========================================

function asNumber(x) {
  const n = Number(String(x).replace(/[^0-9.-]/g, ''));
  return isNaN(n) ? 0 : n;
}

function parseTimeToHours(s) {
  if (!s) return 0;
  s = String(s).trim();
  
  // Handle HH:MM format
  if (s.includes(':')) {
    const parts = s.split(':').map(Number);
    return (parts[0] || 0) + (parts[1] || 0) / 60 + (parts[2] || 0) / 3600;
  }
  
  // Handle decimal
  const n = Number(s);
  return isNaN(n) ? 0 : n;
}

function formatTimeDisplay(s) {
  if (!s) return '-';
  return s;
}

function currency(n) {
  return '‚Çπ' + Number(Math.round(n * 100) / 100).toFixed(2);
}

function round2(n) {
  return Math.round(n * 100) / 100;
}

function showAlert(message, type) {
  const alertBox = document.getElementById('alertBox');
  alertBox.textContent = message;
  alertBox.className = `alert ${type}`;
  alertBox.style.display = 'block';
  
  setTimeout(() => {
    alertBox.style.display = 'none';
  }, 5000);
}

// Debounce function for USD conversion
let usdConversionTimeout;
function debounce(func, delay) {
  return function(...args) {
    clearTimeout(usdConversionTimeout);
    usdConversionTimeout = setTimeout(() => func.apply(this, args), delay);
  };
}

// ========================================
// RECEIPT CALCULATION & UPDATE
// ========================================

function updateReceipt() {
  const pilot = document.getElementById('pilot').value || '';
  const rankEl = document.getElementById('rank');
  const rank = rankEl.value;
  const selRank = rankEl.options[rankEl.selectedIndex];
  const baseRate = asNumber(selRank.getAttribute('data-rate'));
  const maxBonus = asNumber(selRank.getAttribute('data-maxbonus'));

  const aircraftEl = document.getElementById('aircraft');
  const aircraft = aircraftEl.value;
  const mult = Number(aircraftEl.options[aircraftEl.selectedIndex].getAttribute('data-mult') || 1);

  const ftime = document.getElementById('ftime').value;
  let hrs = parseTimeToHours(ftime);
  hrs = round2(hrs);

  const callsign = document.getElementById('callsign').value || '';
  const flightnum = document.getElementById('flightnum').value || '';
  const depicao = document.getElementById('depicao').value.toUpperCase() || '';
  const arricao = document.getElementById('arricao').value.toUpperCase() || '';

  const passengers = asNumber(document.getElementById('passengers').value);
  const cargo = asNumber(document.getElementById('cargo').value);
  const fuelused = asNumber(document.getElementById('fuelused').value);

  // Calculate earnings
  const earnings = round2(hrs * baseRate * mult);

  // Calculate payload bonus
  const seatCapMap = {
    'A319': 136, 'A320': 175, 'B738': 189, 'B737 MAX': 189,
    'A321': 239, 'B788': 364, 'B789': 364, 'B77W': 503,
    'B77L': 441, 'B744': 416, 'A350': 440
  };
  
  const capacity = seatCapMap[aircraft] || 0;
  const loadFactor = capacity ? Math.min(passengers / capacity, 1) : 0;
  const payload = passengers * 95 + cargo;
  const ppp = fuelused ? payload / fuelused : 0;
  const pppRef = 1;
  const efficiencyRatio = ppp / pppRef;
  let score = (loadFactor + efficiencyRatio) / 2;
  if (score > 1) score = 1;
  
  const payloadBonus = round2(Math.min(score * maxBonus, maxBonus));

  // Calculate deduction (15% of earnings)
  const deduction = round2(earnings * 0.15);

  // Calculate grand total
  const grandTotal = round2(earnings + payloadBonus - deduction);

  // Update receipt display
  const today = new Date();
  const dateStr = today.getFullYear() + '-' + 
                  String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                  String(today.getDate()).padStart(2, '0');
  
  document.getElementById('rdate').textContent = dateStr;
  document.getElementById('rno').textContent = 'VA-' + (Math.floor(Math.random() * 9000) + 1000);
  document.getElementById('rpilot').textContent = pilot || '-';
  document.getElementById('rrank').textContent = rank || '-';
  document.getElementById('rcallsign').textContent = callsign ? 'INVA' + callsign : '-';
  document.getElementById('rflightnum').textContent = flightnum || '-';
  document.getElementById('rroute').textContent = depicao && arricao ? `${depicao} ‚Üí ${arricao}` : '-';
  document.getElementById('rair').textContent = aircraft || '-';
  
  // Display time in original format
  const displayTime = ftime;
  document.getElementById('rftime').textContent = ftime ? `${displayTime} (${hrs.toFixed(2)}h)` : '-';
  
  document.getElementById('rbase').textContent = currency(baseRate);
  document.getElementById('rmult').textContent = '√ó' + mult.toFixed(2);
  document.getElementById('rearn').textContent = currency(earnings);
  document.getElementById('rbonus').textContent = currency(payloadBonus);
  document.getElementById('rded').textContent = currency(deduction);
  document.getElementById('grand').textContent = currency(grandTotal);

  // Fetch USD conversion with debouncing
  fetchUSDConversion(grandTotal);
}

// Debounced USD conversion function
const fetchUSDConversion = debounce(function(grandTotal) {
  if (grandTotal === 0) {
    document.getElementById('rusd').textContent = '$0.00';
    return;
  }
  
  fetch("https://api.frankfurter.app/latest?from=INR&to=USD")
    .then(res => res.json())
    .then(data => {
      const rate = data.rates.USD || 0;
      document.getElementById('rusd').textContent = '$' + (grandTotal * rate).toFixed(2);
    })
    .catch(() => {
      document.getElementById('rusd').textContent = '$0.00';
    });
}, 500); // 500ms delay for debouncing

// ========================================
// VALIDATION
// ========================================

function validateForm() {
  const required = ['pilot', 'rank', 'callsign', 'flightnum', 'depicao', 'arricao', 'aircraft', 'ftime', 'passengers', 'cargo', 'fuelused'];
  
  for (const id of required) {
    const el = document.getElementById(id);
    if (!el.value || el.value.trim() === '') {
      showAlert(`Please fill in the ${el.previousElementSibling.textContent.replace(' *', '')} field`, 'error');
      el.focus();
      return false;
    }
  }
  
  return true;
}

// ========================================
// SEND TO DISCORD
// ========================================

async function sendToDiscord(flightData) {
  if (DISCORD_WEBHOOK_URL === "YOUR_DISCORD_WEBHOOK_URL_HERE") {
    console.warn("Discord webhook URL not configured");
    return { success: false, error: "Discord webhook not configured" };
  }

  const embed = {
    title: "‚úàÔ∏è New Flight Submission",
    color: 0x0ea5a4,
    fields: [
      { name: "üë®‚Äç‚úàÔ∏è Pilot", value: flightData.pilot, inline: true },
      { name: "üéñÔ∏è Rank", value: flightData.rank, inline: true },
      { name: "üìû Callsign", value: `INVA${flightData.callsign}`, inline: true },
      { name: "üî¢ Flight Number", value: flightData.flightNumber, inline: true },
      { name: "üõ´ Departure", value: flightData.departure, inline: true },
      { name: "üõ¨ Arrival", value: flightData.arrival, inline: true },
      { name: "‚úàÔ∏è Aircraft", value: flightData.aircraft, inline: true },
      { name: "‚è±Ô∏è Flight Time", value: flightData.flightTime, inline: true },
      { name: "üë• Passengers", value: flightData.passengers.toString(), inline: true },
      { name: "üì¶ Cargo", value: `${flightData.cargo} kg`, inline: true },
      { name: "‚õΩ Fuel Used", value: `${flightData.fuelUsed} kg`, inline: true },
      { name: "üí∞ Grand Total", value: flightData.grandTotal, inline: true }
    ],
    footer: {
      text: "INVA Flight Management System"
    },
    timestamp: new Date().toISOString()
  };

  try {
    const response = await fetch(DISCORD_WEBHOOK_URL, {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        username: "INVA Flight Tracker",
        embeds: [embed]
      })
    });

    if (response.ok) {
      return { success: true };
    } else {
      return { success: false, error: "Discord API error" };
    }
  } catch (error) {
    console.error("Discord error:", error);
    return { success: false, error: error.message };
  }
}

// ========================================
// SEND TO GOOGLE SHEETS
// ========================================

async function sendToGoogleSheets(flightData) {
  if (GOOGLE_SHEET_CONFIG.scriptUrl === "YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE") {
    console.warn("Google Sheets script URL not configured");
    return { success: false, error: "Google Sheets not configured" };
  }

  try {
    const response = await fetch(GOOGLE_SHEET_CONFIG.scriptUrl, {
      method: "POST",
      mode: "no-cors", // Google Apps Script requires no-cors
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(flightData)
    });

    // Note: no-cors mode doesn't allow reading the response
    // We assume success if no error is thrown
    return { success: true };
  } catch (error) {
    console.error("Google Sheets error:", error);
    return { success: false, error: error.message };
  }
}

// ========================================
// SUBMIT FLIGHT
// ========================================

async function submitFlight() {
  if (!validateForm()) {
    return;
  }

  updateReceipt();

  // Gather flight data
  const flightData = {
    date: document.getElementById('rdate').textContent,
    receiptNo: document.getElementById('rno').textContent,
    pilot: document.getElementById('pilot').value,
    rank: document.getElementById('rank').value,
    callsign: document.getElementById('callsign').value,
    flightNumber: document.getElementById('flightnum').value,
    departure: document.getElementById('depicao').value.toUpperCase(),
    arrival: document.getElementById('arricao').value.toUpperCase(),
    aircraft: document.getElementById('aircraft').value,
    flightTime: document.getElementById('ftime').value,
    passengers: document.getElementById('passengers').value,
    cargo: document.getElementById('cargo').value,
    fuelUsed: document.getElementById('fuelused').value,
    baseRate: document.getElementById('rbase').textContent,
    multiplier: document.getElementById('rmult').textContent,
    earnings: document.getElementById('rearn').textContent,
    payloadBonus: document.getElementById('rbonus').textContent,
    deductions: document.getElementById('rded').textContent,
    grandTotal: document.getElementById('grand').textContent,
    grandTotalUSD: document.getElementById('rusd').textContent
  };

  // Disable button during submission
  const sendBtn = document.getElementById('sendBtn');
  sendBtn.disabled = true;
  sendBtn.textContent = '‚è≥ Submitting...';

  // Send to both Discord and Google Sheets
  const [discordResult, sheetsResult] = await Promise.all([
    sendToDiscord(flightData),
    sendToGoogleSheets(flightData)
  ]);

  // Re-enable button
  sendBtn.disabled = false;
  sendBtn.textContent = 'üì§ Submit Flight';

  // Show results
  if (discordResult.success || sheetsResult.success) {
    showAlert('‚úÖ Flight submitted successfully!', 'success');
  } else {
    showAlert('‚ö†Ô∏è Submission completed with warnings. Check console for details.', 'error');
  }
}

// ========================================
// EVENT LISTENERS
// ========================================

// Input formatting and validation
document.getElementById('ftime').addEventListener('input', function(e) {
  updateReceipt();
});

document.getElementById('cargo').addEventListener('input', function(e) {
  // Only allow digits
  this.value = this.value.replace(/[^0-9]/g, '');
  updateReceipt();
});

document.getElementById('callsign').addEventListener('input', function(e) {
  // Only allow digits for callsign
  this.value = this.value.replace(/[^0-9]/g, '');
  updateReceipt();
});

document.getElementById('depicao').addEventListener('input', function(e) {
  // Convert to uppercase
  this.value = this.value.toUpperCase();
  updateReceipt();
});

document.getElementById('arricao').addEventListener('input', function(e) {
  // Convert to uppercase
  this.value = this.value.toUpperCase();
  updateReceipt();
});

document.getElementById('sendBtn').addEventListener('click', submitFlight);

document.getElementById('printBtn').addEventListener('click', function() {
  updateReceipt();
  setTimeout(() => window.print(), 150);
});

// Live receipt preview - update on any input change
const fieldsToWatch = ['pilot', 'rank', 'aircraft', 'flightnum', 'passengers', 'fuelused'];

fieldsToWatch.forEach(id => {
  const el = document.getElementById(id);
  if (el) {
    el.addEventListener('input', updateReceipt);
    el.addEventListener('change', updateReceipt);
  }
});

// Initial update
updateReceipt();
</script>

</body>
</html>
