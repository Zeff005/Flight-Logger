<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INVA Receipt Generator</title>
<style>
  body { font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; margin:18px; background:#f3f4f6; color:#0f172a; }
  .wrap { max-width:900px; margin:0 auto; background:#fff; padding:18px; border-radius:10px; box-shadow:0 8px 30px rgba(2,6,23,0.08); }
  h1 { font-size:18px; margin:0 0 6px; }
  .muted { color:#475569; font-size:13px; }
  .grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px; }
  label { display:block; font-size:13px; margin-bottom:6px; font-weight:500; }
  input, select, textarea { width:100%; padding:8px; border-radius:8px; border:1px solid #e6e9ef; box-sizing:border-box; }
  textarea { min-height:64px; }
  .controls { display:flex; gap:8px; margin-top:12px; }
  button { padding:8px 12px; border-radius:8px; border:none; background:#0ea5a4; color:#fff; cursor:pointer; font-size:14px; }
  button:hover { background:#0d8f8e; }
  .receipt { margin-top:18px; padding:14px; border:1px solid #e6e9ef; border-radius:8px; background:#ffffff; }
  .rhead { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
  table { width:100%; border-collapse:collapse; margin-top:8px; }
  td, th { padding:8px; border-bottom:1px solid #f1f5f9; text-align:left; }
  .right { text-align:right; }
  .small { font-size:13px; color:#475569; }
  @media print {
    body{background:#fff;margin:0;padding:20px;}
    .wrap{box-shadow:none;padding:0;max-width:100%;}
    .grid{display:block;}
    .grid>div:first-child{display:none;}
    .receipt{border:none;margin:0;padding:0;}
    button{display:none;}
    h1,.muted{display:none;}
  }
</style>
</head>
<body>

<div class="wrap">
  <h1>INVA Receipt Generator</h1>
  <div class="muted">Enter flight details on the left, preview receipt on the right. All rates and multipliers are pre-loaded.</div>

  <div class="grid">
    <div>
      <label>Pilot Name
        <input type="text" id="pilot" placeholder="Rahul">
      </label>

      <label>Rank
        <select id="rank">
          <option value="">-- choose rank --</option>
          <option value="Cadet / Trainee" data-rate="1333" data-maxbonus="750">Cadet / Trainee</option>
          <option value="Junior FO" data-rate="1800" data-maxbonus="1250">Junior FO</option>
          <option value="First Officer" data-rate="2600" data-maxbonus="2250">First Officer</option>
          <option value="Senior FO" data-rate="3100" data-maxbonus="2750">Senior FO</option>
          <option value="Captain" data-rate="3500" data-maxbonus="3250">Captain</option>
          <option value="Senior Captain" data-rate="3800" data-maxbonus="3750">Senior Captain</option>
          <option value="Chief Pilot" data-rate="4000" data-maxbonus="4250">Chief Pilot</option>
        </select>
      </label>

      <label>INVA Callsign (3 digits)
        <input type="text" id="callsign" placeholder="e.g. 123" maxlength="3" pattern="\d{3}">
      </label>

      <label>Flight Number
        <input type="text" id="flightnum" placeholder="e.g. IX998">
      </label>

      <label>Departure ICAO
        <input type="text" id="depicao" placeholder="e.g. VIDP" maxlength="4">
      </label>

      <label>Arrival ICAO
        <input type="text" id="arricao" placeholder="e.g. VABB" maxlength="4">
      </label>

      <label>Aircraft
        <select id="aircraft">
          <option value="">-- choose aircraft --</option>
          <option value="A319" data-mult="1.00">A319 — ×1.00</option>
          <option value="A320" data-mult="1.00">A320 — ×1.00</option>
          <option value="B738" data-mult="1.00">B738 — ×1.00</option>
          <option value="B737 MAX" data-mult="1.05">B737 MAX — ×1.05</option>
          <option value="A321" data-mult="1.05">A321 — ×1.05</option>
          <option value="B788" data-mult="1.15">B788 — ×1.15</option>
          <option value="B789" data-mult="1.15">B789 — ×1.15</option>
          <option value="B77W" data-mult="1.25">B77W — ×1.25</option>
          <option value="B77L" data-mult="1.25">B77L — ×1.25</option>
          <option value="B744" data-mult="1.50">B744 — ×1.50</option>
          <option value="A350" data-mult="1.35">A350 — ×1.35</option>
        </select>
      </label>

      <label>Flight Time (hh:mm or decimal hours)
        <input type="text" id="ftime" placeholder="e.g. 03:34 or 3.5667">
      </label>

      <label>Passengers Carried
        <input type="number" id="passengers" placeholder="e.g. 150">
      </label>

      <label>Cargo Weight (kg)
        <input type="number" id="cargo" placeholder="e.g. 3000">
      </label>

      <label>Fuel Used (kg)
        <input type="number" id="fuelused" placeholder="e.g. 20000">
      </label>

      <div class="controls">
        <button type="button" id="sendBtn">Send</button>
        <button type="button" id="printBtn">Print / Save PDF</button>
      </div>
      <div class="small" style="margin-top:8px">Tip: choose Rank/Aircraft to auto-fill Base Rate & Multiplier.</div>
    </div>

    <div>
      <div class="receipt" id="receipt">
        <div class="rhead">
          <div>
            <h2 style="margin:0">INVA RECEIPT</h2>
            <div class="small">Receipt #: <span id="rno">VA-0001</span></div>
            <div class="small">Date: <span id="rdate"></span></div>
          </div>
          <div class="small">INVA — Career Mode</div>
        </div>

        <table>
          <tbody>
            <tr><td>Pilot</td><td id="rpilot">-</td></tr>
            <tr><td>Rank</td><td id="rrank">-</td></tr>
            <tr><td>INVA Callsign</td><td id="rcallsign">-</td></tr>
            <tr><td>Flight Number</td><td id="rflightnum">-</td></tr>
            <tr><td>Departure ICAO</td><td id="rdepicao">-</td></tr>
            <tr><td>Arrival ICAO</td><td id="rarricao">-</td></tr>
            <tr><td>Aircraft</td><td id="rair">-</td></tr>
            <tr><td>Flight Time (hh:mm)</td><td id="rftime">-</td></tr>
            <tr><td>Base Rate (₹)</td><td id="rbase">0.00</td></tr>
            <tr><td>Multiplier</td><td id="rmult">1.00</td></tr>
          </tbody>
        </table>

        <table style="margin-top:8px">
          <tbody>
            <tr><td><strong>Earnings (Flight)</strong></td><td class="right" id="rearn">0.00</td></tr>
            <tr><td><strong>Payload Bonus</strong></td><td class="right" id="rbonus">0.00</td></tr>
            <tr><td>Deductions (Taxes/Misc)</td><td class="right" id="rded">0.00</td></tr>
            <tr><td><strong>Grand Total (Earnings + Bonus - Deduction)</strong></td><td class="right" id="grand">0.00</td></tr>
            <tr><td><strong>Estimated Earnings (USD)</strong></td><td class="right" id="rusd">$0.00</td></tr>
          </tbody>
        </table>

        <div style="margin-top:12px" class="small">Notes: Generated for INVA in-game use only. Do not use for fraudulent real-world claims.</div>
      </div>
    </div>
  </div>
</div>

<script>
function asNumber(x){var n=Number(String(x).replace(/[^0-9.-]/g,''));return isNaN(n)?0:n;}
function parseTimeToHours(s){if(!s)return 0;s=String(s).trim();if(s.includes(':')){var p=s.split(':').map(Number);return(p[0]||0)+(p[1]||0)/60+(p[2]||0)/3600;}var n=Number(s);return isNaN(n)?0:n;}
function currency(n){return'₹'+Number(Math.round(n*100)/100).toFixed(2);}
function round2(n){return Math.round(n*100)/100;}

function updateReceipt(){
  var pilot=document.getElementById('pilot').value||'';
  var rankEl=document.getElementById('rank');
  var rank=rankEl.value;
  var selRank=rankEl.options[rankEl.selectedIndex];
  var baseRate=asNumber(selRank.getAttribute('data-rate'));
  var maxBonus=asNumber(selRank.getAttribute('data-maxbonus'));

  var aircraftEl=document.getElementById('aircraft');
  var aircraft=aircraftEl.value;
  var mult=Number(aircraftEl.options[aircraftEl.selectedIndex].getAttribute('data-mult')||1);

  var ftime=document.getElementById('ftime').value;
  var hrs=parseTimeToHours(ftime);
  hrs = round2(hrs);

  var callsign=document.getElementById('callsign').value||'';
  var flightnum=document.getElementById('flightnum').value||'';
  var depicao=document.getElementById('depicao').value.toUpperCase()||'';
  var arricao=document.getElementById('arricao').value.toUpperCase()||'';

  var passengers=asNumber(document.getElementById('passengers').value);
  var cargo=asNumber(document.getElementById('cargo').value);
  var fuelused=asNumber(document.getElementById('fuelused').value);

  var earnings = round2(hrs*baseRate*mult);

  var seatCapMap={'A319':136,'A320':175,'B738':189,'B737 MAX':189,'A321':239,'B788':364,'B789':364,'B77W':503,'B77L':441,'B744':416,'A350':440};
  var capacity=seatCapMap[aircraft]||0;
  var LF=capacity?Math.min(passengers/capacity,1):0;
  var Payload=passengers*95+cargo;
  var PPP=fuelused?Payload/fuelused:0;
  var PPP_ref=1;
  var efficiencyRatio=PPP/PPP_ref;
  var score=(LF+efficiencyRatio)/2;
  if(score>1) score=1;
  var payloadBonus=Math.min(score*maxBonus,maxBonus);

  var deduction = round2(earnings*0.15);

  var grand = round2(earnings + payloadBonus - deduction);

  var today=new Date();
  var dateStr=today.getFullYear()+'-'+String(today.getMonth()+1).padStart(2,'0')+'-'+String(today.getDate()).padStart(2,'0');
  document.getElementById('rdate').textContent=dateStr;
  document.getElementById('rno').textContent='VA-'+(Math.floor(Math.random()*9000)+1000);
  document.getElementById('rpilot').textContent=pilot||'-';
  document.getElementById('rrank').textContent=rank||'-';
  document.getElementById('rcallsign').textContent=callsign?'INVA'+callsign:'-';
  document.getElementById('rflightnum').textContent=flightnum||'-';
  document.getElementById('rdepicao').textContent=depicao||'-';
  document.getElementById('rarricao').textContent=arricao||'-';
  document.getElementById('rair').textContent=aircraft||'-';
  document.getElementById('rftime').textContent=ftime||'-';
  document.getElementById('rbase').textContent=currency(baseRate);
  document.getElementById('rmult').textContent=mult.toFixed(2);

  document.getElementById('rearn').textContent=currency(earnings);
  document.getElementById('rbonus').textContent=currency(payloadBonus);
  document.getElementById('rded').textContent=currency(deduction);
  document.getElementById('grand').textContent=currency(grand);

  // INR → USD
  fetch("https://api.frankfurter.app/latest?from=INR&to=USD")
    .then(res=>res.json()).then(data=>{
      var rate=data.rates.USD||0;
      document.getElementById('rusd').textContent='$'+(grand*rate).toFixed(2);
    }).catch(()=>{document.getElementById('rusd').textContent='$0.00';});
}

function calculateAndSend(){
  updateReceipt();

  // Discord webhook
  const webhookURL = "https://discordapp.com/api/webhooks/1424101218283946128/GuS7iqwSLSZyRR6yYgqu2yjjn3Y4nvEq6CG0rb_yT_lZxEdQaRGjGcSZvCDOtWf2GOHN"; // <-- replace this
  var pilot = document.getElementById('pilot').value || '';
  var rank = document.getElementById('rank').value || '';
  var dep = document.getElementById('depicao').value.toUpperCase() || '';
  var arr = document.getElementById('arricao').value.toUpperCase() || '';
  var aircraft = document.getElementById('aircraft').value || '';
  var ftime = document.getElementById('ftime').value || '';
  var pax = document.getElementById('passengers').value || '';
  var cargo = document.getElementById('cargo').value || '';
  var fuelused = document.getElementById('fuelused').value || '';
  var grand = document.getElementById('grand').textContent || '';

  const payload = {
    username: "INVA Bot",
    embeds: [{
      title: "Flight Submission",
      color: 3447003,
      fields:[
        {name:"Pilot", value: pilot, inline:true},
        {name:"Rank", value: rank, inline:true},
        {name:"Departure", value: dep, inline:true},
        {name:"Arrival", value: arr, inline:true},
        {name:"Aircraft", value: aircraft, inline:true},
        {name:"Flight Time", value: ftime, inline:true},
        {name:"Passengers", value: pax, inline:true},
        {name:"Cargo (kg)", value: cargo, inline:true},
        {name:"Fuel Used (kg)", value: fuelused, inline:true},
        {name:"Grand Total", value: grand, inline:true}
      ],
      timestamp: new Date()
    }]
  };

  fetch(webhookURL, {method:"POST", headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
// Show confirmation message
    const msgDiv = document.createElement('div');
    msgDiv.textContent = '✅ Flight submitted successfully!';
    msgDiv.style.color = '#0ea5a4';
    msgDiv.style.fontWeight = '500';
    msgDiv.style.marginTop = '8px';
    this.parentElement.appendChild(msgDiv);

    // Remove message after 3 seconds
    setTimeout(() => {
        msgDiv.remove();
    }, 3000);
});
}

// Event listeners
document.getElementById('sendBtn').addEventListener('click', calculateAndSend);
document.getElementById('printBtn').addEventListener('click', function(){updateReceipt(); setTimeout(()=>window.print(),150);});

// Live receipt preview only
['pilot','rank','aircraft','ftime','flightnum','depicao','arricao','callsign','passengers','cargo','fuelused'].forEach(function(id){
  var el=document.getElementById(id);
  el.addEventListener('input', updateReceipt);
  el.addEventListener('change', updateReceipt);
});

updateReceipt();
</script>

</body>
</html>
